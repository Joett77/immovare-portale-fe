<section class="bg-white py-16 px-6 mb:px-4">
  <div class="container mx-auto text-center">
    @if (isHpBlock()) {
      <h2 class="heading-lg font-extrabold font-montserrat text-primary-dark mb-8"
        >Hanno già immovato con noi
      </h2>
      <p class="text-black text-lg mb-10">Chi ha scelto Immovare.it per vendere casa</p>
    } @else {
      @if (buildings().length === 0) {
        <app-not-logged-card
          [sectionObj]="emptyStateFavoriteProperties"
          titleCard="Immobili preferiti"
          [imgUrl]="notLoggedFavoritePropertiesImg"
        ></app-not-logged-card>
      } @else {
        <div class="flex md:flex-row md:flex-nowrap md:justify-between md:items-start">
          <h2 class="mb-2 md:mb-8 heading-lg font-extrabold font-montserrat text-primary-dark">
            Immobili preferiti
          </h2>
          @if (!isMobile) {
            <div class="flex justify-end">
              <app-button
                (click)="linkToPage()"
                class="w-full lg:w-fit"
                [text]="'Vedi tutti'"
                size="md"
                [hasBorder]="true"
                [icon]="true"
              >
              </app-button>
            </div>
          }
        </div>
      }
    }

    <!-- Loading state -->
    @if (isLoading) {
      <div class="flex justify-center items-center p-12">
        <div
          class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-dark"
        ></div>
      </div>
    }

    <!-- Error state -->
    @if (hasError) {
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <p>Si è verificato un errore nel caricamento degli immobili. Riprova più tardi.</p>
      </div>
    }

    <!-- Content when data is loaded -->
    @if (!isLoading && !hasError && buildings().length > 0) {
      <div class="flex flex-wrap -mx-2 mb-8">
        <swiper-container
          slides-per-view="1"
          pagination="true"
          pagination-clickable="true"
          space-between="10"
          breakpoints='{"768": {"slidesPerView": 2}, "1024": {"slidesPerView": 3} ,"1280": {"slidesPerView": 4}}'
          class="w-full"
        >
          @for (card of buildings(); track card.id) {
            <swiper-slide class="pb-16">
              <a
                [routerLink]="['/property', card.id]"
                class="block"
              >
                <div
                  class="bg-white rounded overflow-hidden cursor-pointer border border-[#CBCCCD]"
                >
                  <div class="relative h-48">
                    <div
                      class="absolute inset-0 bg-cover bg-center"
                      [style.background-image]="'url(' + (card.images || '') + ')'"
                    ></div>

                    <div
                      *ngIf="card.status"
                      class="absolute inset-0"
                      [ngStyle]="getStatusPositionStyle(card.status)"
                      [class]="getStatusClasses(card.status)"
                    >
                      {{ card.status }}
                    </div>
                  </div>
                  <div
                    class="flex flex-col flex-grow justify-between px-6 py-6 gap-y-4 md:min-h-[220px] lg:gap-y-0"
                  >
                    <!-- Località e Titolo -->
                    <div class="text-left">
                      <span class="text-[10px] lg:text-xs text-[#97999B] uppercase font-open-sans">
                        {{ card.city }} {{ card.district ? '- ' + card.district : '' }}
                        {{ card.region ? '- ' + card.region : '' }}
                      </span>
                      <h2 class="font-bold text-primary-dark heading-xs">
                        {{ card.type }} in {{ card.address
                        }}{{ card.house_number ? ', ' + card.house_number : ''
                        }}{{ card.city ? ', ' + card.city : ''
                        }}{{ card.district ? ', ' + card.district : ''
                        }}{{ card.region ? ', ' + card.region : ''
                        }}{{ card.country ? ', ' + card.country : '' }}
                      </h2>
                    </div>

                    <!-- Info della proprietà (Locali, Dimensione, Bagni) e Prezzo -->
                    <div class="flex items-center justify-between mt-2 text-black">
                      <div class="w-full flex flex-col gap-y-2 text-sm">
                        <div class="w-full flex flex-row justify-between items-center">
                          <div class="flex flex-nowrap w-min-[160px] items-center gap-x-2">
                            <app-floorplan-icon class="w-4 h-4"></app-floorplan-icon>
                            <span>{{ card.number_rooms }} {{ card.type }}</span>
                          </div>

                          <div class="flex flex-nowrap w-min-[160px] items-center gap-x-2">
                            <app-measure-icon class="w-4 h-4"></app-measure-icon>
                            <span>{{ card.square_metres }}</span>
                          </div>

                          <div class="flex flex-nowrap w-min-[160px] items-center gap-x-2">
                            <app-bath-icon class="w-4 h-4"></app-bath-icon>
                            <span>{{ card.number_baths }} bagni</span>
                          </div>
                        </div>
                        <div class="w-full mt-4 flex flex-row justify-between items-center">
                          <span
                            class="text-[12px] lg:text-s text-[#97999B] uppercase font-open-sans"
                          >
                            {{ card.category ? card.category : '' }},
                            {{ card.type ? card.type : '' }}
                          </span>
                          @if (card.price) {
                            <span class="text-sm font-bold pt-4 lg:pl-0 lg:pt-0 lg:text-lg">
                              {{ card.price }}
                            </span>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </a>
            </swiper-slide>
          }
        </swiper-container>
      </div>
    }

    <!-- No results state -->
    @if (!isLoading && !hasError && buildings().length === 0) {
      <div class="py-8 text-center">
        <p class="text-gray-500">Nessun immobile disponibile al momento.</p>
      </div>
    }

    <!-- No pagination controls needed -->

    @if (isMobile && !isHpBlock()) {
      <div class="p-4 w-full">
        <app-button
          (click)="linkToPage()"
          class="w-full lg:w-fit"
          [text]="'Vai agli annunci'"
          size="md"
          [hasBorder]="true"
          [icon]="true"
        ></app-button>
      </div>
    }
  </div>
</section>
