<!-- property-publishing.component.html - Updated with validation -->
<div class="property-publishing-container">
  <!-- Loading Indicator -->
  @if (isLoading()) {
    <div
      class="fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center bg-white bg-opacity-75 z-50"
    >
      <div class="text-center">
        <div
          class="spinner-border text-primary"
          role="status"
        >
          <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-2">Caricamento in corso...</p>
      </div>
    </div>
  }

  <!-- Error Message -->
  @if (hasError()) {
    <div class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50">
      <div
        class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-lg max-w-md"
      >
        <div class="flex items-center">
          <svg
            class="w-5 h-5 mr-2"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
              clip-rule="evenodd"
            />
          </svg>
          <span class="text-sm">{{ errorMessage() }}</span>
        </div>
      </div>
    </div>
  }

  <!-- Success Message -->
  @if (publishSuccess()) {
    <div class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50">
      <div
        class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg max-w-md"
      >
        <div class="flex items-center">
          <svg
            class="w-5 h-5 mr-2"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
              clip-rule="evenodd"
            />
          </svg>
          <span class="text-sm">Annuncio pubblicato con successo!</span>
        </div>
      </div>
    </div>
  }

  <!-- Preview Step Header (only shown in step 6) -->
  @if (currentStep() === 6) {
    <app-property-toolbar
      (editEvent)="goToEdit()"
      (publishEvent)="publishListing()"
      (goToMyAdsEvent)="goToMyAds()"
      [property]="propertyDraft()"
    ></app-property-toolbar>
  }

  <!-- Dynamic content based on current step -->
  @if (currentStep() === 0) {
    <app-step-address
      [title]="title()"
      [formData]="formData().address"
    />
  }

  @if (currentStep() === 1) {
    <app-step-features
      [title]="title()"
      [isFreePublishing]="true"
      [formData]="formData().features"
    />
  }

  @if (currentStep() === 2) {
    <app-step-extra-features
      [title]="title()"
      [isFreePublishing]="true"
      [formData]="formData().extraFeatures"
    />
  }

  @if (currentStep() === 3) {
    <app-step-price
      [title]="title()"
      [formData]="formData().price"
    />
  }

  @if (currentStep() === 4) {
    <app-step-file-upload
      type="file"
      [title]="title()"
      [description]="descFileUploader"
      [propertyId]="advertisementId()"
    />
  }

  @if (currentStep() === 5) {
    <app-step-file-upload
      type="map"
      [title]="title()"
      [description]="descMapUploader"
      [propertyId]="advertisementId()"
    />
  }

  @if (currentStep() === 6) {
    <app-property-preview [property]="propertyDraft()" />
  }

  <!-- Navigation stepper (hide in preview step) -->
  @if (currentStep() !== 6) {
    <app-publishing-stepper
      [steps]="steps"
      [currentStep]="currentStep()"
      [canProceedToNextStep]="canProceedToNextStep()"
      (stepChange)="onStepChange($event)"
    />
  }
</div>
